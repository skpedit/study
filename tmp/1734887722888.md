import { Component, EventEmitter, Input, Output } from '@angular/core';
import { MarkdownEditorComponent } from '../markdown-editor/markdown-editor.component';
import { CommonModule } from '@angular/common';
import { GithubService } from '../services/github.service';

@Component({
  selector: 'skp-tmp',
  standalone: true,
  imports: [MarkdownEditorComponent, CommonModule],
  templateUrl: './tmp.component.html',
  styleUrl: './tmp.component.scss'
})
export class TmpComponent {
  savedFile: string = '';
  @Input() data: any = { id: '1', value: '' };
  @Output() dataChange = new EventEmitter<any>();

  constructor(public githubService: GithubService) {

  }

  sendData(event: any) {
    this.data.value = event.value;
  }

  async onClipboardPaste() {
    try {
      if (navigator.clipboard) {
        const copyContent = await navigator.clipboard.readText();
        this.paste(copyContent);
      }
    } catch (error) {
      console.error('Failed to read clipboard:', error);
    }
  }

  async paste(data: string) {
    this.data.value = data;
    this.dataChange.emit(this.data);
    this.savedFile = '';
  }

  saveClipData() {
    if (this.data.value && this.githubService.github.owner) {
      const encodedContent = btoa(unescape(encodeURIComponent(this.data.value)));
      this.githubService.uploadTmpFile(encodedContent).subscribe((res: any) => {
        this.savedFile = res.content.path;
        this.data.value = '';
      });
    }
  }
}
